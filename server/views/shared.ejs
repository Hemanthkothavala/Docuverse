<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Shared Files</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        .active {
            background-color: #c4b5fd;
            font-weight: 600;
        }

        .file-icon {
            background: linear-gradient(to bottom right, #d8b4fe, #c084fc);
            color: white;
        }

        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-thumb {
            background-color: #8b5cf6;
            border-radius: 10px;
        }

        .nav-link.active {
            background-color: #e9d5ff;
            box-shadow: inset 2px 2px 6px #c084fc;
            color: #7e22ce;
            font-weight: bold;
            border-radius: 10px;
            transform: translateX(10px);
            font-size: 20px;
        }


        body {
            overflow-x: hidden;
        }
    </style>
</head>

<body class="bg-gradient-to-br from-purple-50 via-white to-purple-100 text-gray-800 overflow-x-hidden">

    <!-- Sidebar -->
    <aside id="sidebar"
        class="fixed top-0 left-0 h-full w-56 bg-purple-100 z-40 overflow-y-auto transform -translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out">
        <div class="flex items-center justify-between h-20 px-6 bg-purple-300 border-b border-purple-300">
            <div class="flex items-center space-x-2">
                <div class="w-10 h-10 rounded-lg bg-purple-500 text-white flex items-center justify-center font-bold">D
                </div>
                <span class="text-lg font-semibold">Docuverse</span>
            </div>
            <button id="closeSidebarBtn"
                class="md:hidden text-purple-700 hover:text-purple-900 text-2xl font-bold">&times;</button>
        </div>

        <nav class="flex flex-col px-6 py-8 space-y-6">
            <a href="/afterlogin"
                class="nav-link flex items-center space-x-3 p-2 rounded hover:bg-purple-200 transition-colors">
                üè† <span>Home</span>
            </a>
            <a href="/files"
                class="nav-link flex items-center space-x-3 p-2 rounded hover:bg-purple-200 transition-colors">
                üìÑ <span class="font-semibold">Files</span>
            </a>
            <a href="/aichat"
                class="nav-link flex items-center space-x-3 p-2 rounded hover:bg-purple-200 transition-colors">
                ü§ñ <span class="font-semibold">Docu-AI</span>
            </a>
            <a href="/shared"
                class="nav-link flex items-center space-x-3 p-2 rounded hover:bg-purple-200 transition-colors">

                üîó <span class="font-semibold">Shared</span>
            </a>
        </nav>

        <form action="/logout" method="post" class="block md:hidden px-6 mt-4">
            <button type="submit"
                class="w-full bg-red-100 text-red-700 font-semibold px-4 py-2 rounded hover:bg-red-200 transition">
                Logout
            </button>
        </form>
    </aside>

    <!-- Main Content -->
    <main class="w-full md:pl-56">
        <!-- Combined Header Row -->
        <div class="bg-gradient-to-r from-purple-600 to-purple-400 text-white shadow-md">
            <div class="max-w-6xl mx-auto flex flex-wrap items-center justify-between gap-4 px-4 py-6">

                <!-- Left: Hamburger button -->
                <div class="flex items-center">
                    <button id="hamburgerBtn" class="md:hidden bg-purple-700 text-white p-2 rounded shadow-md">
                        <svg class="w-6 h-6" fill="none" stroke="white" stroke-width="2" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>
                </div>

                <!-- Center: Title and subtitle -->
                <div class="text-center flex-1 min-w-[200px] ">
                    <h1 class="text-4xl font-bold">üìÅ Shared Files</h1>
                    <p class="text-md mt-2">View and manage files shared with you</p>
                </div>

                <!-- Right: Logout button -->
                <form action="/logout" method="post" class="hidden md:block">
                    <button type="submit"
                        class="bg-red-100 text-red-700 border border-red-300 px-4 py-2 rounded-lg font-bold hover:bg-red-200 transition whitespace-nowrap">
                        Logout
                    </button>
                </form>

            </div>
        </div>


        <!-- Content -->
        <div class="max-w-6xl mx-auto p-6">


            <div class="bg-white shadow-xl rounded-2xl p-8">
                <% if (sharedFiles.length===0) { %>
                    <div class="text-center text-gray-500 text-lg py-16">No shared files available. üì≠</div>
                    <% } else { %>
                        <div class="space-y-6">
                            <% sharedFiles.forEach(file=> { %>
                                <div
                                    class="flex flex-col md:flex-row justify-between items-start md:items-center gap-6 p-4 bg-gradient-to-br from-white via-purple-50 to-white rounded-xl border border-purple-100 shadow-sm hover:shadow-md transition">
                                    <div class="flex items-start gap-4 w-full md:w-3/4">
                                        <div
                                            class="w-12 h-12 file-icon rounded-md flex items-center justify-center text-xl font-bold shadow-inner">
                                            üìÑ</div>
                                        <div class="flex-1">
                                            <h3 class="text-lg font-semibold text-purple-800 break-words">
                                                <%= file.originalname %>
                                            </h3>
                                            <p class="text-sm text-gray-600 mt-1">
                                                <strong>Type:</strong>
                                                <%= file.type %><br>
                                                    <strong>Size:</strong>
                                                    <%= Math.round(file.size / 1024) %> KB<br>
                                                        <strong>Sender:</strong>
                                                        <%= file.senderName %> (<%= file.senderEmail %>)
                                            </p>
                                        </div>
                                    </div>
                                    <div class="flex gap-3 w-full md:w-auto">
                                        <a href="/uploads/<%= file.senderEmail %>/<%= file.filename %>" download
                                            class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md shadow font-medium transition">Download</a>
                                        <button type="button" data-id="<%= file._id %>"
                                            class="delete-button bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-md shadow font-medium transition">Delete</button>
                                    </div>
                                </div>
                                <% }) %>
                        </div>
                        <% } %>
            </div>
        </div>
    </main>

    <!-- Script -->
    <script>
        const sidebar = document.getElementById('sidebar');
        const hamburgerBtn = document.getElementById('hamburgerBtn');
        const closeSidebarBtn = document.getElementById('closeSidebarBtn');

        hamburgerBtn?.addEventListener('click', () => {
            sidebar.classList.remove('-translate-x-full');
        });
        document.querySelectorAll('.nav-link').forEach(link => {
            if (link.href === location.href) link.classList.add('active');
        });

        closeSidebarBtn?.addEventListener('click', () => {
            sidebar.classList.add('-translate-x-full');
        });

        document.querySelectorAll('.delete-button').forEach(button => {
            button.addEventListener('click', async () => {
                const fileId = button.dataset.id;
                if (!confirm("Are you sure you want to delete this file?")) return;

                try {
                    const res = await fetch(`/delete-shared/${fileId}`, { method: 'DELETE' });
                    const result = await res.json();

                    if (result.ok) {
                        button.closest('div').remove();
                        if (document.querySelectorAll('.delete-button').length === 0) {
                            document.querySelector('.bg-white').innerHTML = '<div class="text-center text-gray-500 text-lg py-16">No shared files available. üì≠</div>';
                        }
                    } else {
                        alert("Failed to delete file.");
                    }
                } catch (err) {
                    console.error(err);
                    alert("An error occurred while deleting.");
                }
            });
        });
    </script>

</body>

</html>